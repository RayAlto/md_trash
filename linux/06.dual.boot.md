# 关于 Linux 和 Windows 双系统

## 配对同一个蓝牙设备

先在 Linux 下配对这个设备，重启到 Windows 再配对一遍，重启到 Linux ，记得挂载 Windows 分区，进入 `<Windows 分区>/Windows/System32/config/` ：

```shell
chntpw -e SYSTEM
```

进入 chntpw 的 shell ，可以查看 Windows 下的注册表内容了

```shell
cd CurrentControlSet\Services\BTHPORT\Parameters\Keys
```

> 如果没有 `CurrentControlSet` 可以试试 `ControlSet001` 之类的

```shell
ls
```

可以看到设备蓝牙适配器的 MAC 地址

```shell
cd <MAC>
ls
```

可以看到这个蓝牙适配器配对的设备 ID

```shell
cd <ID>
ls
```

可以看到这个设备的一些信息，通过 `hex <value name>` 获取这个值的 hex dump ，用 Linux 任意 Shell 进入 `/var/lib/bluetooth/<MAC>` ， `ls` 看看 Linux 下配对了的设备 ID ，找到跟上面 chntpw 里看到的 ID 最相似的一个，重命名为 chntpw 里看到的 ID ，编辑 `<ID>/info` ，用 `chntpw` 里的：

1. `IRK` 替换 `IdentityResolvingKey` 里的 `Key`
1. `CSRK` 替换 `LocalSignatureKey` 里的 `Key`
1. `LTK` 替换 `LongTermKey` 里的 `Key`
1. `ERand` 替换 `Rand` （进行一次大小端转换，然后转换成十进制值）
1. `EDIV` 替换 `EDiv` （进行一次大小端转换，然后转换成十进制；或直接抄上面在 chntpw 最后一次 `ls` 里 `EDIV` 的值）

然后再重启一下就可以了
