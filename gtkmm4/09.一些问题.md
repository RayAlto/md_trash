# ä¸€äº›é—®é¢˜

Gtk çš„ API ä¸åŒç‰ˆæœ¬éƒ½æœ‰å¾ˆå¤§çš„å˜åŒ–ï¼Œæºç é‡Œä¹Ÿè¿˜æœ‰å¾ˆå¤š TODO ï¼Œè¿˜æ˜¯å®¹æ˜“æœ‰ä¸€äº›é—®é¢˜å¾ˆéš¾æ‰¾åˆ°ç›¸å…³çš„æ–‡æ¡£

## `Gdk::Pixbuf` å¯¹çŸ¢é‡å›¾è¿›è¡Œ scale æ—¶å¤±çœŸ

å…¶å® `Gdk::Pixbuf::create_from_xx` ç³»åˆ—å‡½æ•°å¯ä»¥ä¼  width å’Œ height è¿›å»ã€‚ä½†æœ‰çš„æ—¶å€™å¼€å‘è€…å¹¶ä¸å–œæ¬¢æ¯æ¬¡ scale éƒ½è¦é‡æ–°è¯»ä¸€éæ–‡ä»¶ï¼Œå¼€å‘è€…æ›´å¸Œæœ›èƒ½æŠŠæ–‡ä»¶è¯»è¿›å†…å­˜ï¼Œç„¶å `Gdk::Pixbuf` æœ€å¥½æœ‰ä¸€ä¸ªæ–¹æ³•èƒ½ä»å†…å­˜è¯»æ–‡ä»¶çš„ data ç„¶ååˆ›å»º `Gdk::Pixbuf` ï¼Œå¯æƒœæˆ‘ç¿»äº†ç¿»æ–‡æ¡£ï¼Œå‘ç°å¹¶æ²¡æœ‰è¿™ä¹ˆæ–¹ä¾¿çš„æ–¹æ³•ï¼Œå³ä½¿ `Gdk::Pixbuf::create_from_resource` ä¹Ÿè®©æˆ‘è§‰å¾—è¿™ä¸ªæ–¹æ³•æ¯æ¬¡éƒ½è¦ä» `Gio::Resource` é‡Œéå†ä¸€éæ¥æ‰¾åˆ°æˆ‘æƒ³è¦çš„æ–‡ä»¶ã€‚æ‰€ä»¥æˆ‘æ‰¾åˆ°äº† `Gdk::PixbufLoader` ï¼Œè¿™ä¸ªä¸œè¥¿å¯ä»¥è¯» `unsigned char*` åç”Ÿæˆ `Gdk::Pixbuf` ï¼Œè¿™æ ·å°±è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼š

```c++
unsigned char svg_data[] {R"+*(<svg>...</svg>)+*"};
std::size_t svg_data_length = 114514;
Glib::RefPtr<Gdk::PixbufLoader> pixbuf_loader = Gdk::PixbufLoader::create();
pixbuf_loader->set_size(114514, 1919810);
pixbuf_loader->write(svg_data, svg_data_length);
pixbuf_loader->close();
Glib::RefPtr<Gdk::Pixbuf> pixbuf = pixbuf_loader->get_pixbuf();
```

è¿™æ ·æœ€åå¾—åˆ°çš„ pixbuf å°±æ˜¯ svg ç»è¿‡ lossless scaling å¾—åˆ°çš„ï¼ˆå¾—åˆ°çš„ pixbuf å°±ä¸æ˜¯çŸ¢é‡äº†ï¼Œå† scale è¿˜æ˜¯ä¼šæ˜¯çœŸçš„ï¼‰

å¦‚æœæ”¾åœ¨äº† `Gio::Resource` é‡Œçš„è¯ä¹Ÿå¾ˆç®€å•ï¼š

```c++
Glib::RefPtr<const Glib::Bytes> data_bytes =
    Gio::Resource::lookup_data_global(source_);
std::size_t image_data_length_;
const unsigned char* image_data_ = reinterpret_cast<const unsigned char*>(
    data_bytes->get_data(image_data_length_));
pixbuf_loader_->write(image_data_,
                      image_data_length_);
```

## ç»™é¼ æ ‡ pressed ã€ released ç»‘å®š callback

è¿™ä¸ªä¸œè¥¿åœ¨ Gtkmm3 åˆ° Gtkmm4 å˜åŒ–å¾ˆå¤§ï¼Œç›®å‰çš„æ–¹æ³•æ˜¯æ·»åŠ  `Gtk::EventController` ï¼š

```c++
// æ¯”å¦‚ç»™è¿™ä¸ª Gtk::Label æ·»åŠ  EventController
Gtk::Label& label = *Gtk::make_managed<Gtk::Label>("æ‰“ä¸ªğŸ¦¶å…ˆ");
// åˆ›å»ºä¸€ä¸ª Gtk::GestureClick ï¼Œæ˜¯ä¸€ä¸ªä¸“é—¨å¯¹äºé¼ æ ‡æŒ‰é”®ç‰¹åŒ–çš„ Gtk::EventController
Glib::RefPtr<Gtk::GestureClick> press_controller =
    Gtk::GestureClick::create();
// åªç›‘å¬é¼ æ ‡å·¦é”®
press_controller->set_button(GDK_BUTTON_PRIMARY);
// ç»™ pressed ç»‘å®šå›è°ƒ
press_controller->signal_pressed().connect(
    [&](int press_count, double x, double y) -> void {
        std::cout << "æ‰“ä¸ªğŸ¦¶å…ˆ" << std::endl;
    });
// ç»™ released ç»‘å®šå›è°ƒ
press_controller->signal_released().connect(
    [&](int press_count, double x, double y) -> void {
        std::cout << "ğŸ’¦" << std::endl;
    });
// æŠŠè¿™ä¸ª Controller å¡ç»™ label
label.add_controller(press_controller);
```
