# æ›´å¤šå¸¸è§çš„ç»„ä»¶

ç»§[ä¸Šç¯‡](./02.ä¸€äº›å¸¸è§çš„ç»„ä»¶.md)

1. [å¯¹è¯æ¡† `Gtk::Dialog`](#å¯¹è¯æ¡†-gtkdialog-)
   1. [æ¶ˆæ¯å¯¹è¯æ¡† `Gtk::MessageDialog`](#æ¶ˆæ¯å¯¹è¯æ¡†-gtkmessagedialog-)
   1. [æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡† `Gtk::FileChooserDialog`](#æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†-gtkfilechooserdialog-)
   1. [é¢œè‰²é€‰æ‹©å¯¹è¯æ¡† `Gtk::ColorChooserDialog`](#é¢œè‰²é€‰æ‹©å¯¹è¯æ¡†-gtkcolorchooserdialog-)
   1. [å­—ä½“é€‰æ‹©å¯¹è¯æ¡† `Gtk::FontChooserDialog`](#å­—ä½“é€‰æ‹©å¯¹è¯æ¡†-gtkfontchooserdialog-)
   1. [å…³äºå¯¹è¯æ¡† `Gtk::AboutDialog`](#å…³äºå¯¹è¯æ¡†-gtkaboutdialog-)
1. [ç»˜ç”»åŒºåŸŸç»„ä»¶ `Gtk::DrawingArea`](#ç»˜ç”»åŒºåŸŸç»„ä»¶-gtkdrawingarea-)
   1. [ç”»ç›´çº¿](#ç”»ç›´çº¿)
   1. [ç”»æ›²çº¿](#ç”»æ›²çº¿)
   1. [ç”»åœ†](#ç”»åœ†)
   1. [ç”»æ–‡å­—](#ç”»æ–‡å­—)
   1. [ç”»å›¾ç‰‡](#ç”»å›¾ç‰‡)
1. [æ‹–æ”¾](#æ‹–æ”¾)
   1. [æ‹–](#æ‹–-gtkdragsource-)
   1. [æ”¾](#æ”¾-gtkdroptarget-)
1. [å‰ªåˆ‡æ¿](#å‰ªåˆ‡æ¿-gdkclipboard-)
   1. [å†™å‰ªåˆ‡æ¿](#å†™å‰ªåˆ‡æ¿)
   1. [è¯»å‰ªåˆ‡æ¿](#è¯»å‰ªåˆ‡æ¿)

## å¯¹è¯æ¡†ï¼ˆ `Gtk::Dialog` ï¼‰

ç›´æ¥ç»§æ‰¿è‡ª `Gtk::Window` ï¼Œæœ‰å¾ˆå¤šç§ä¸åŒé¢„è®¾å¯¹è¯æ¡†ï¼Œå¦‚æœæƒ³è¦æ·»åŠ æ›´å¤šç»„ä»¶å¯ä»¥ `get_content_area()` è·å¾— `Gtk::Dialog` çš„ `Gtk::Box` ï¼›å¦‚æœåªéœ€è¦åœ¨åº•éƒ¨æ”¾ä¸€ä¸ª `Gtk::Button` çš„è¯å¯ä»¥ç›´æ¥ `add_button()`

### æ¶ˆæ¯å¯¹è¯æ¡†ï¼ˆ `Gtk::MessageDialog` ï¼‰

å°±æ˜¯å±•ç¤ºæ¶ˆæ¯çš„å¯¹è¯æ¡†ï¼š

```c++
Gtk::MessageDialog(
    /* parent window */ *this,
    /* title         */ "message",
    /* use_markup    */ false,
    /* message type  */ Gtk::MessageType::QUESTION,
    /* button type   */ Gtk::ButtonType::OK_CANCEL,
    /* modal         */ false
)
```

å…·ä½“çš„ä¿¡æ¯è¿˜å¯ä»¥ `Gtk::MessageDialog::set_secondary_text()` è®¾ç½®ï¼Œè¿˜æœ‰ `Gtk::MessageDialog::set_hide_on_close()` å¯ä»¥æä¾›æ›´åƒå¯¹è¯æ¡†çš„äº¤äº’é€»è¾‘ã€‚å½“ç”¨æˆ·ç‚¹äº†å¸¦æœ‰é€»è¾‘çš„æŒ‰é’®åä¼šè§¦å‘ `signal_response()` ï¼Œæœ‰ä¸€ä¸ª `int response_id` å‚æ•°ï¼Œå¯ä»¥é€šè¿‡ `enum Gtk::ResponseType::XXX` æ¥ `switch`ã€‚

![æ¶ˆæ¯å¯¹è¯æ¡†](../imgs/gtkmm4-message_dialog.gif "æ¶ˆæ¯å¯¹è¯æ¡†")

### æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†ï¼ˆ `Gtk::FileChooserDialog` ï¼‰

éƒ½å·®ä¸å¤šï¼š

```c++
Gtk::FileChooserDialog(
    /* parent window  */ *this,
    /* title          */ "Open",
    /* action         */ Gtk::FileChooserDialog::Action::OPEN,
    /* use header bar */ false
)
```

> è¿™é‡Œç¬¬å››ä¸ªå‚æ•°æœ€å¥½å¡« `false` å¦‚æœå¡« `true` ä¼šå¯¼è‡´æŒ‰é’®ä¸æ˜¾ç¤º

å¯ä»¥åŠ ä¸€äº› `filter` æ¥é™åˆ¶é€‰æ‹©æ–‡ä»¶çš„ç±»å‹ï¼š

```c++
Glib::RefPtr<Gtk::FileFilter> filter = Gtk::FileFilter::create()
filter->set_name("C Source File")
filter->add_suffix("c");
filter->add_mime_type("text/x-c"); // è¿™ä¸ªå¥½åƒä¸æ€ä¹ˆå‡†
file_chooser_dialog->add_filter(filter);
```

![æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†](../imgs/gtkmm4-file_chooser_dialog.gif "æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†")

### é¢œè‰²é€‰æ‹©å¯¹è¯æ¡†ï¼ˆ `Gtk::ColorChooserDialog` ï¼‰

é€‰é¢œè‰²çš„ï¼Œé»˜è®¤æœ‰ä¸¤ä¸ªæŒ‰é’® `Select` å’Œ `Cancel` ï¼Œä¸€èˆ¬ä¸ç”¨å†åŠ æŒ‰é’®äº†ã€‚é€šè¿‡ `Gtk::ColorChooserDialog::get_rgba()` å¯ä»¥è·å–ç”¨æˆ·é€‰æ‹©çš„é¢œè‰²ï¼ˆå¦‚æœç”¨æˆ·æ²¡æœ‰é€‰æ‹©çš„è¯è¿™ä¸ªæ–¹æ³•å¯èƒ½æ²¡æœ‰æ„ä¹‰ï¼Œæœ€å¥½æ”¾åœ¨ `signal_response()` çš„å›è°ƒé‡Œï¼š

![é¢œè‰²é€‰æ‹©å¯¹è¯æ¡†](../imgs/gtkmm4-color_chooser_dialog.gif "é¢œè‰²é€‰æ‹©å¯¹è¯æ¡†")

### å­—ä½“é€‰æ‹©å¯¹è¯æ¡†ï¼ˆ `Gtk::FontChooserDialog` ï¼‰

é€‰å­—ä½“çš„ï¼Œä¹Ÿé»˜è®¤æœ‰ä¸¤ä¸ªæŒ‰é’® `Select` å’Œ `Cancel` ï¼Œé€šè¿‡ `Gtk::FontChooserDialog::get_font()` å¯ä»¥è·å–ç”¨æˆ·é€‰æ‹©çš„å­—ä½“çš„ pango font description å­—ç¬¦ä¸²

![å­—ä½“é€‰æ‹©å¯¹è¯æ¡†](../imgs/gtkmm4-font_chooser_dialog.gif "å­—ä½“é€‰æ‹©å¯¹è¯æ¡†")

### å…³äºå¯¹è¯æ¡†ï¼ˆ `Gtk::AboutDialog` ï¼‰

å¥½å¤š GNOME åº”ç”¨éƒ½æœ‰è¿™ä¸ªä¸œè¥¿ï¼Œå¯ä»¥è®¾ç½®å¾ˆå¤šä¸œè¥¿ï¼š

```c++
about_dialog_.set_transient_for(*this);
about_dialog_.set_modal();
about_dialog_.set_hide_on_close();
about_dialog_.set_logo(Gdk::Texture::create_from_filename(
    "my-awesome-logo.png"));
about_dialog_.set_program_name("1919 Application");
about_dialog_.set_version("114.514");
about_dialog_.set_copyright("Ray Alto");
about_dialog_.set_comments("ä½ æ˜¯ä¸€ä¸ªä¸€ä¸ªä¸€ä¸ª");
about_dialog_.set_license("WTFL");
about_dialog_.set_website("https://www.rayalto.top");
about_dialog_.set_website_label("Ray Alto's Blog");
about_dialog_.set_authors({"Ray Alto", "Anonymous", "Ace Taffy"});
/* about_dialog_.set_titlebar(*Gtk::make_managed<Gtk::HeaderBar>()); */
```

> æ³¨æ„è¿™é‡ŒæŠŠ `set_titlebar` æ³¨é‡Šæ‰äº†ï¼Œå› ä¸º `Gtk::AboutDialog` æœ‰ä¸€ä¸ªè‡ªå·±çš„ title bar ï¼Œå†è®¾ç½®ä¸€ä¸ª title bar ä¼šè¦†ç›–æ‰åŸç”Ÿçš„ title bar

![å…³äºå¯¹è¯æ¡†](../imgs/gtkmm4-about_dialog.gif "å…³äºå¯¹è¯æ¡†")

## ç»˜ç”»åŒºåŸŸç»„ä»¶ï¼ˆ `Gtk::DrawingArea` ï¼‰

> è®°å¾— `set_expand()`

å¯ä»¥é€šè¿‡ `Gtk::DrawingArea::set_draw_func()` æ¥è®¾ç½®ç»˜åˆ¶å›è°ƒï¼Œå…¶ä¸­ä¸‰ä¸ªå‚æ•°åˆ†åˆ«ä¸ºï¼š

1. `const Cairo::RefPtr<Cairo::Context>& context`: Cairo çš„ä¸Šä¸‹æ–‡ï¼Œç”¨æ¥å®é™…ç»˜åˆ¶å›¾åƒ
1. `int width`: ç”»å¸ƒçš„å®½åº¦
1. `int height`: ç”»å¸ƒçš„é•¿åº¦

> 1. `Cairo::Context::scale()` ä¼ å…¥ç”»å¸ƒçš„å¤§å°åï¼Œç”¨æˆ·å°±å¯ä»¥ä½¿ç”¨ç›¸å¯¹å€¼ï¼ˆ 0.0 - 1.0 ä¹‹é—´ï¼‰è¡¨ç¤ºç”»å¸ƒä¸Šçš„ç‚¹äº†
> 1. `Cairo::Context::translate()` ä¼ å…¥ä¸€ä¸ªåæ ‡ï¼Œè¿™ä¸ªåæ ‡å°±ä¼šå˜æˆåŸç‚¹ï¼Œåé¢ä½¿ç”¨çš„æ‰€æœ‰åæ ‡éƒ½æ˜¯ç›¸å¯¹ä¸è¿™ä¸ªåæ ‡çš„
>
> æ³¨æ„å¦‚æœç”¨äº†è¿™äº›çš„è¯å¦‚æœç»„ä»¶å°ºå¯¸è¿‡å°çš„æ—¶å€™å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºå´©æºƒ

### ç”»ç›´çº¿

- `Cairo::Context::move_to`: æŠŠç”»ç¬”æŠ¬èµ·æ¥ï¼Œç§»åŠ¨åˆ°ä¸€ä¸ªåæ ‡
- `Cairo::Context::line_to`: æŠŠç¬”æŒ‰åˆ°ç”»å¸ƒä¸Šï¼Œç›´çº¿ç§»åŠ¨åˆ°ä¸€ä¸ªåæ ‡ï¼Œåˆ›å»ºä¸€ä¸ªç›´çº¿è·¯å¾„
- `Cairo::Context::stroke`: ç»™è·¯å¾„æè¾¹
- `Cairo::Context::fill`: å¡«å……è·¯å¾„
- `Cairo::Context::paint`: æŠŠå½“å‰çš„ `source` å¡«æ»¡æ•´ä¸ªåŒºåŸŸ

> `Cairo::Context::clip()` ï¼Œ `Cairo::Context::fill()` ï¼Œ `Cairo::Context::stroke()` ä¸€èˆ¬éƒ½ä¼šæ¸…é™¤å½“å‰è·¯å¾„ï¼Œå‡†å¤‡åˆ›å»ºä¸€ä¸ªæ–°çš„è·¯å¾„ï¼Œä½†å®ƒä»¬éƒ½æœ‰å¯¹åº”çš„ `_preserve()` å¯ä»¥ä¿ç•™å½“å‰çš„è·¯å¾„ï¼Œæ¯”å¦‚è°ƒç”¨äº† `stroke_preserve()` ä¹‹åè¿˜å¯ä»¥ `fill()` ï¼Œå¦‚æœè°ƒç”¨äº† `stroke()` ä¹‹å `fill()` æ˜¯æ— æ•ˆçš„ï¼Œå› ä¸º `stroke()` æ¸…ç©ºäº†è·¯å¾„ `fill()` ä¸ä¼šå¡«å……ä»»ä½•è·¯å¾„

æ¯”å¦‚ç”»ä¸€ä¸ªå…«è¾¹å½¢ï¼ˆ `Cairo::Context::move_to` å’Œ `Cairo::Context::line_to` ï¼‰ï¼š

![ç»˜ç”»åŒºåŸŸç”»å…«è¾¹å½¢](../imgs/gtkmm4-drawing_area-simple.gif "ç»˜ç”»åŒºåŸŸç”»å…«è¾¹å½¢")

`Cairo::Context::set_line_join()` å¯ä»¥è®¾ç½®çº¿æ¡çš„è¿æ¥ç±»å‹ï¼š

| `Cairo::Context::LineJoin::MITER`                                                 | `Cairo::Context::LineJoin::ROUND`                                             | `Cairo::Context::LineJoin::BEVEL`                                                 |
| --------------------------------------------------------------------------------- | ----------------------------------------------------------------------------- | --------------------------------------------------------------------------------- |
| ![Cairoæ–œæ¥çº¿æ¡](../imgs/gtkmm4-drawing_area-line_join_miter.png "Cairoæ–œæ¥çº¿æ¡") | ![Cairoåœ†çº¿æ¡](../imgs/gtkmm4-drawing_area-line_join_round.png "Cairoåœ†çº¿æ¡") | ![Cairoæ–œåˆ‡çº¿æ¡](../imgs/gtkmm4-drawing_area-line_join_bevel.png "Cairoæ–œåˆ‡çº¿æ¡") |

> å¦‚æœå›¾å½¢æ˜¯å°é—­çš„ç”»æœ€åçš„çº¿æ¡å¯èƒ½å¹¶ä¸è¿è´¯ï¼Œå¯ä»¥ `Cairo::Context::close_path()` æ¥é—­åˆç»ˆç‚¹å’Œèµ·ç‚¹

### ç”»æ›²çº¿

> å°±æ˜¯ä¸‰æ¬¡è´å¡å°”æ›²çº¿

- `Cairo::Context::curve_to`: ç›®å‰ç”»ç¬”æ‰€åœ¨åæ ‡ä½œä¸ºèµ·ç‚¹ï¼Œä¼ å…¥ä¸‰ç»„åæ ‡ï¼ˆæ§åˆ¶ç‚¹ä¸€ã€æ§åˆ¶ç‚¹äºŒã€ç»ˆç‚¹ï¼‰ï¼Œç”»å‡ºä¸€æ¡ä¸‰æ¬¡è´å¡å°”æ›²çº¿

![ç»˜ç”»åŒºåŸŸç”»è´å¡å°”æ›²çº¿](../imgs/gtkmm4-drawing_area-bezier_curve.png "ç»˜ç”»åŒºåŸŸç”»è´å¡å°”æ›²çº¿")

### ç”»åœ†

- `Cairo::Context::arc`: ç”»åœ†ï¼Œå‚æ•°å¦‚ä¸‹ï¼š
  1. `double x`: åŸç‚¹ X è½´åæ ‡
  1. `double y`: åŸç‚¹ Y è½´åæ ‡
  1. `double radius`: åŠå¾„
  1. `double angle1`: èµ·ç‚¹ï¼ˆ 0 - 2PI ï¼‰
  1. `double angle2`: ç»ˆç‚¹ï¼ˆ 0 - 2PI ï¼‰

![ç»˜ç”»åŒºåŸŸç”»åœ†](../imgs/gtkmm4-drawing_area-arc.gif "ç»˜ç”»åŒºåŸŸç”»åœ†")

### ç”»æ–‡å­—

æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ `Gtk::Widget::create_pango_layout("text")` åˆ›å»ºä¸€ä¸ª `Pango::Layout` ï¼Œç„¶åç”¨ `Pango::Layout::show_in_cairo_context()` ç”»åœ¨ `Cairo::Context` é‡Œ

```c++
Pango::FontDescription font;
font.set_family("VictorMono Nerd Font");
font.set_style(Pango::Style::ITALIC);
font.set_size(width / 6 * Pango::SCALE);
cr->set_source_rgb(utils::color2float(0xed),
                   utils::color2float(0x21),
                   utils::color2float(0x3a));
Glib::RefPtr<Pango::Layout> layout = create_pango_layout("RayAlto");
layout->set_font_description(font);
int text_width, text_height;
layout->get_pixel_size(text_width, text_height);
cr->move_to((width - text_width) / 2.0, (height - text_height) / 2.0);
layout->show_in_cairo_context(cr);
```

![ç»˜ç”»åŒºåŸŸç”»æ–‡å­—](../imgs/gtkmm4-drawing_area-text.gif "ç»˜ç”»åŒºåŸŸç”»æ–‡å­—")

### ç”»å›¾ç‰‡

`Gdk::Pixbuf::create_from_xxx()` å¯ä»¥åˆ›å»º `Glib::RefPtr<Gdk::Pixbuf>` ï¼Œè€Œä¸”å¯ä»¥è®¾ç½®ç›®æ ‡å¤§å°ã€æ˜¯å¦ä¿æŒå›¾ç‰‡åŸæ¯”ä¾‹ã€‚ç„¶åå¯ä»¥ `Gdk::Cairo::set_source_pixbuf()` æŠŠåˆ›å»ºå¥½çš„ `Gdk::Pixbuf` å¡è¿› `Cairo::Context` é‡Œï¼Œç„¶å `Cairo::Context::rectangle()` ï¼Œ `Cairo::Context::fill()` æŠŠå›¾ç‰‡ç”»å‡ºæ¥ï¼š

```c++
Glib::RefPtr<Gdk::Pixbuf> image = Gdk::Pixbuf::create_from_file(
    "my-awesome-image.svg", width * 0.8, height * 0.8);
Gdk::Cairo::set_source_pixbuf(cr,
                              image,
                              (width - image->get_width()) / 2.0,
                              (height - image->get_height()) / 2.0);
cr->rectangle((width - image->get_width()) / 2.0,
              (height - image->get_height()) / 2.0,
              image->get_width(),
              image->get_height());
cr->fill();
```

> `Gdk::Cairo::set_source_pixbuf` æ¥è‡ªå¤´æ–‡ä»¶ `gdkmm/general.h`

![ç»˜ç”»åŒºåŸŸç”»å›¾ç‰‡](../imgs/gtkmm4-drawing_area-image.gif "ç»˜ç”»åŒºåŸŸç”»å›¾ç‰‡")

## æ‹–æ”¾

æ‹–æ”¾ä¹Ÿæ˜¯ä¸€ç§ `Gtk::EventController` éœ€è¦ç»„ä»¶é€šè¿‡ `Gtk::Widget::add_controller()` åŠ è¿›å»

### æ‹–ï¼ˆ `Gtk::DragSource` ï¼‰

é€šè¿‡ `Gtk::DragSource::create()` åˆ›å»ºä¸€ä¸ª `Glib::RefPtr<Gtk::DragSource>` ï¼Œé€šè¿‡ç»™å®ƒçš„å„ç§ `signal` æ·»åŠ å›è°ƒå¯ä»¥å®ç°æ‹–ï¼š

```c++
Glib::RefPtr<Gtk::DragSource> source = Gtk::DragSource::create();
source->set_actions(Gdk::DragAction::COPY);
source->signal_prepare().connect(
    [&](double x, double y) -> Glib::RefPtr<Gdk::ContentProvider> {
        std::cout << "drag signal_prepare" << std::endl;
        Glib::Value<Glib::ustring> ustring_value;
        ustring_value.init(ustring_value.value_type());
        ustring_value.set("ä½ æ˜¯ä¸€ä¸ªä¸€ä¸ªä¸€ä¸ª");
        return Gdk::ContentProvider::create(ustring_value);
    },
    false);
// source->signal_drag_begin().connect(
//     [&](const Glib::RefPtr<Gdk::Drag>& drag) -> void {
//         // ...
//     });
// source->signal_drag_cancel().connect(
//     [&](const Glib::RefPtr<Gdk::Drag> drag,
//         Gdk::DragCancelReason reason) -> bool {
//         // ...
//     },
//     false);
// source->signal_drag_end().connect(
//     [&](const Glib::RefPtr<Gdk::Drag>& drag, bool delete_data) -> void {
//         // ...
//     },
//     false);
```

ç„¶åé€‰å¥½ä¸€ä¸ªç»„ä»¶ï¼Œæ¯”å¦‚æˆ‘é€‰æ‹©ä¸€ä¸ª `Gtk::Label label` ï¼ŒæŠŠè¿™ä¸ª `Gtk::DragSource` å¡è¿›å»ï¼š

```c++
label.add_controller(source);
```

### æ”¾ï¼ˆ `Gtk::DropTarget` ï¼‰

é€šè¿‡ `Gtk::DropTarget::create()` åˆ›å»ºä¸€ä¸ª `Glib::RefPtr<Gtk::DropTarget>` ï¼Œé€šè¿‡ç»™å®ƒçš„å„ç§ `signal` æ·»åŠ å›è°ƒå¯ä»¥å®ç°æ”¾ï¼š

```c++
Glib::RefPtr<Gtk::DropTarget> target = Gtk::DropTarget::create(
    Glib::Value<Glib::ustring>::value_type(), Gdk::DragAction::COPY);
target->signal_drop().connect(
    [&](const Glib::ValueBase& value, double x, double y) -> bool {
        std::cout << "drop signal_drop" << std::endl;
        if (G_VALUE_HOLDS(value.gobj(),
                          Glib::Value<Glib::ustring>::value_type())) {
            Glib::Value<Glib::ustring> ustring_value;
            ustring_value.init(value.gobj());
            const Glib::ustring& dropped_string = ustring_value.get();
            std::cout << "Received: " << dropped_string << std::endl;
            return true;
        }
        else {
            std::cout << "Received unexpected data type ["
                      << G_VALUE_TYPE_NAME(value.gobj()) << "]"
                      << std::endl;
            return false;
        }
    },
    false);
// target->signal_accept().connect(
//     [&](const Glib::RefPtr<Gdk::Drop>& drop) -> bool {
//         // ...
//     },
//     false);
// target->signal_enter().connect(
//     [&](double x, double y) -> Gdk::DragAction {
//         // ...
//     },
//     false);
// target->signal_leave().connect(
//     [&]() -> void {
//         // ...
//     },
//     false);
// target->signal_motion().connect(
//     [&](double x, double y) -> Gdk::DragAction {
//         // ...
//     },
//     false);
```

ç„¶åé€‰å¥½ä¸€ä¸ªç»„ä»¶ï¼Œæ¯”å¦‚æˆ‘é€‰æ‹©ä¸€ä¸ª `Gtk::Button button` ï¼ŒæŠŠè¿™ä¸ª `Gtk::DragSource` å¡è¿›å»ï¼š

```c++
button.add_controller(target);
```

æ•ˆæœå°±åƒè¿™æ ·ï¼š

![æ‹–æ”¾çº¯æ–‡æœ¬](../imgs/gtkmm4-drag_and_drop-plain_text.gif "æ‹–æ”¾çº¯æ–‡æœ¬")

### æ›´å¤æ‚çš„æ‹–æ”¾

- `Gtk::DropControllerMotion`: ç”¨äºç›‘æµ‹æ‹–æ”¾æ“ä½œè¿‡ç¨‹ä¸­çš„åŠ¨ä½œï¼Œæ¯”å¦‚æ‹–æ”¾è¿‡ç¨‹ä¸­é¼ æ ‡è¿›å…¥ã€ç¦»å¼€ç»„ä»¶
- `Gtk::DropTargetAsync`: åŠŸèƒ½æœ€ä¸°å¯Œçš„ç›‘æµ‹æ”¾æ“ä½œçš„ controller ï¼Œå¾ˆå¤š API ä¸ `Gtk::DropTarget` ä¸åŒ

## å‰ªåˆ‡æ¿ï¼ˆ `Gdk::Clipboard` ï¼‰

é€šè¿‡ `Gtk::Widget::get_clipboard` æˆ– `Gdk::Display::get_clipboard` è·å–åˆ° `Glib::RefPtr<Gdk::Clipboard>`

### å†™å‰ªåˆ‡æ¿

æœ‰ä¸€ç³»åˆ— `Gdk::Clipboard::set_xx` æ–¹æ³•ï¼Œæœ€ç®€å•çš„å¯ä»¥ `Gdk::Clipboard::set_text("114514")` ï¼Œä¸‹é¢å±•ç¤ºä¸€ç§å¤æ‚çš„æ–¹æ³•ï¼š

```c++
Glib::Value<Glib::ustring> value;
value.init(value.value_type());
value.set("114514");
Glib::RefPtr<Gdk::ContentProvider> content = Gdk::ContentProvider::create(value);
get_clipboard()->set_content(content);
```

### è¯»å‰ªåˆ‡æ¿

ä¹Ÿæœ‰ä¸€ç³»åˆ— `Gdk::Clipboard::read_xx` æ–¹æ³•ï¼Œä¸‹é¢å±•ç¤ºæœ€ç®€å•çš„æ–¹æ³•ï¼ˆå‡è®¾å†…å®¹æ˜¯æ–‡æœ¬ï¼‰ï¼š

```c++
get_clipboard()->read_text_async(
    [&](Glib::RefPtr<Gio::AsyncResult>& result) -> void {
        Glib::ustring text;
        try {
            text = get_clipboard()->read_text_finish(result);
        }
        catch (const Glib::Error& err) {
            std::cout << "Read clipboard error: " << err.what()
                      << std::endl;
        }
        std::cout << "Read from clipboard: " << text << std::endl;
    });
```

## æ‰“å°

> æš‚æ—¶ç”¨ä¸åˆ°

## æœ€è¿‘ä½¿ç”¨è¿‡çš„æ–‡ä»¶

> æš‚æ—¶ç”¨ä¸åˆ°

## é”®ç›˜äº‹ä»¶

`Gtk::EventControllerKey::create()` å¯ä»¥è·å– `Glib::RefPtr<Gtk::EventControllerKey>` ï¼Œå¯¹è¿™ä¸ªä¸œè¥¿ä¼šå‘å‡º `signal_key_press()` å’Œ `signal_key_release()` ï¼Œç”¨äºå¯¹é”®ç›˜äº‹ä»¶è¿›è¡Œå“åº”ï¼š

```c++
Glib::RefPtr<Gtk::EventControllerKey> key_controller =
    Gtk::EventControllerKey::create();
key_controller->signal_im_update().connect(
    [&]() -> void { std::cout << "IM Updated" << std::endl; });
key_controller->signal_key_pressed().connect(
    [&](guint key_value, guint key_code, Gdk::ModifierType state) -> bool {
        if ((key_value == GDK_KEY_1)
            && (state
                & (Gdk::ModifierType::SHIFT_MASK
                   | Gdk::ModifierType::CONTROL_MASK
                   | Gdk::ModifierType::ALT_MASK))
                   == Gdk::ModifierType::ALT_MASK) {
            // Alt + 1
            left_label.set_text("ğŸ’¦");
            return true;
        }
        return false;
    },
    false);
key_controller->signal_key_released().connect(
    [&](guint key_value, guint key_code, Gdk::ModifierType state) -> void {
        if ((key_value == GDK_KEY_1)
            && (state
                & (Gdk::ModifierType::SHIFT_MASK
                   | Gdk::ModifierType::CONTROL_MASK
                   | Gdk::ModifierType::ALT_MASK))
                   == Gdk::ModifierType::ALT_MASK) {
            // Alt + 1
            left_label.set_text("æ‰“ä¸ªğŸ¦¶å…ˆ");
        }
    },
    false);
```

ç„¶åæŠŠè¿™ä¸ª controller å¡åˆ° `Gtk::Window` é‡Œï¼š

> å¡è¿› `Gtk::Window` é‡Œçš„ç»„ä»¶å¯èƒ½ä¸ä¼šå“åº”ï¼Œå› ä¸ºäº‹ä»¶ä¼šå…ˆåˆ°è¾¾ `Gtk::Window` ï¼Œåªæœ‰ `Gtk::Window` å¯¹åº”çš„é”®ç›˜äº‹ä»¶å›è°ƒè¿”å› `false` è¿™ä¸ªäº‹ä»¶æ‰ä¼šç»§ç»­å¾€ä¸‹ä¼ 

```c++
add_controller(key_controller);
```

![ç®€å•çš„é”®ç›˜äº‹ä»¶](../imgs/gtkmm4-event_controller_key-alt_1.gif "ç®€å•çš„é”®ç›˜äº‹ä»¶")
